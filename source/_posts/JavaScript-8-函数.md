---
title: JavaScript-8.函数.md
date: 2019-01-08 16:05:13
tags: JavaScript
categories: JavaScript
---
函数：是一段Javascript代码，定义一次后可以被多次调用。
函数调用时拥有一个值—-本次调用的上下文,即this的值

## this的指向和闭包
如果函数挂载在一个对象上，作为对象的一个属性，就称这个函数为对象的方法
当通过这个对象调用这个函数时,这个对象就是此次调用的上下文,也就是this指向这个对象

用于初始化一个新创建的对象的函数称为构造函数（constructor） 

闭包：javascript函数可以嵌套在其他函数中，这样就可以访问它们被定义时所处的作用域中的任何变量，这就构成了闭包。

## 函数的定义
#### 函数语句式定义
变量声明被提前，函数名是必须的

#### 函数表达式定义
函数名可选
如果一个函数定义表达式包含名称,函数的局部作用域将包含一个绑定到函数对象的名称.
实际上函数名称将成为函数内部的一个局部变量
函数表达式通常适用只用到一次的场景。
无法在定义前调用

return语句会导致函数停止运行，并返回它的表达式给这个函数的调用者,没有return 或者没有相关表达式则返回undefined给调用者
没有返回值的函数，有时候称为过程

## 函数调用
    1.作为函数
    2.作为方法
    3.作为构造函数
    4.通过他们的call()和apply()方法间接调用

##### 作为函数调用
普通的函数调用基本是一个函数对象加上左圆括号加上参数加上右圆括号组成的像"getAllList(x,y)"

函数调用的返回值：如果因为解释器到达结尾，返回undefined。如果因为解释器执行到return 则返回return后的语句。如果return语句没有值返回undefined

在es3和非严格模式的es5中以函数调用的函数this指向全局对象，严格模式this是undefined
例：判断当前是否是严格模式
```
var static = (function(){return !this;}());
//严格模式下this的返回值是undefined所以函数返回true
```

##### 作为方法调用
方法调用的参数和返回值的处理完全等同于函数调用。他们之间的区别就是调用的上下文不同即“this”的指向不同
属性访问表达式由两个部分组成“对象名称+属性名称” 这个对象成了调用的上下文，即“this”指向这个对象
例：
```
var a = {
    x:1,
    y:2,
    c:function(){
        this.z = this.x+this.y;
    }
}
a.c();//先执行c()方法
a.z;//输入3
ps:方括号的方式也可以访问 a["c"]()
```
任何函数只要当做方法调用都会传入一个隐式的实参，这个实参是一个对象，方法调用的母体就是这个对象

方法链：当方法的返回值是一个对象的时候，这个对象还可以调用它自己的方法，这种调用序列通称为链后者级联。
当方法不需要返回值的时候，最好直接返回“this”因为当前放回调用他的对象就可以继续在后面调用其他方法，这就实现了“链式调用”（此处的方法调用不同意构造函数的链式调用）

##### 使用this的注意事项
1.this并不是一个变量，也不是一个属性名它是关键字，javascript不允许给关键字赋值
2.this没有作用域的限制，嵌套函数不会从调用他的函数中继承this，如果嵌套函数作为方法调用，this指向调用的对象。如果嵌套函数作为函数调用，这个函数在非严格模式下指向全局对象，严格模式返回undefined。
嵌套函数中的函数调用需访问外部函数的this值需要提前将this保存在一个变量，这个变量和函数同在一个作用域内。
例：
```
var o = {
    a:1,
    b:2,
    c:function(){
        var self = this;//将this保存在self变量中
        console.log(this);//对象o中的方法c()。this指向调用他的对象o
        console.log(this === o);//返回true

        function test(){ //嵌套函数
            console.log(self === o);//返回true self是外部函数的this值
            console.log(this === o);//返回false,this指向全局对象，或者undefined
        }
    }
}
o.c(); //调用o中的c方法
```

##### 构造函数调用
构造函数：如果函数或者方法调用之前带有关键字 new,它就构成了构造函数。
如果构造函数调用含有实参，先计算实参再传入函数内
如果没有参数可以省略后面的圆括号
```
var o = new Object();
var o = new Object;
//以上代码是等价的
```
构造函数调用创建的新的空对象，这个对象继承自构造函数的prototype属性 。构造函数试图初始化这个新创建的对象，并将这个对象作为调用的上下文，即“this”指向这个新创建的对象
```
var o = new Object;
o.m = function(){
    console.log(this === o);
}
new o().m();//输出是false
```